<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Simulazione Camera & Omografia</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Test Omografia & Blob World Coordinates</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <img #cameraImgRef
             [src]="streamUrl"
             [width]="imgWidth"
             (load)="onCameraLoad(cameraImgRef)"
             style="border:1px solid #888; margin-top: 0.5em; max-width:100%; height:auto; display:block;">
            </ion-item>
          <div style="display: flex; gap: 0.5em; margin-top: 1em;">
            <ion-button color="secondary" (click)="saveFrameCalibration()">Salva Frame Calibrazione</ion-button>
            <ion-button (click)="calibrateCamera()">Calibra</ion-button>
          </div>
      <!-- Keypoints
      <ion-accordion-group>
        <ion-accordion value="keypoints">
          <ion-item slot="header">
            <ion-label>Mostra/Nascondi Keypoints ({{ keypoints.length }})</ion-label>
          </ion-item>
          <ion-list slot="content">
            <div style="display: flex; flex-wrap: wrap; gap: 1em;">
              <span *ngFor="let kp of keypoints; let i = index">
                [{{ kp[0] | number:'1.0-1' }}, {{ kp[1] | number:'1.0-1' }}]
              </span>
            </div>
          </ion-list>
        </ion-accordion>
      </ion-accordion-group>
      <ion-item *ngIf="keypoints.length === 0" lines="none">
        <ion-label>Nessuno</ion-label>
      </ion-item>
      <ion-button expand="block" (click)="fetchKeypoints()">Aggiorna Keypoints</ion-button> -->


    <!-- <ion-item lines="none" style="margin-top:1em;">
        <ion-label>
          <b>Camera Matrix:</b>
        </ion-label>
      </ion-item>
      <ion-grid *ngIf="homography.length">
        <ion-row *ngFor="let row of homography">
          <ion-col *ngFor="let val of row" style="border:1px solid #888; padding:0.3em 0.7em; text-align:right;">
            {{ val | number:'1.4-4' }}
          </ion-col>
        </ion-row>
      </ion-grid> -->

      <ion-accordion-group>
        <ion-accordion value="coordinates">
          <ion-item slot="header">
            <ion-label>Mostra/Nascondi coordinate ({{ coordinates.length }})</ion-label>
          </ion-item>
          <ion-list slot="content">
            <div style="display: flex; flex-wrap: wrap; gap: 1em;">
              <span *ngFor="let point of coordinates; let i = index">
                [{{ point[0] | number:'1.0-1' }}, {{ point[1] | number:'1.0-1' }}]
              </span>
            </div>
          </ion-list>
        </ion-accordion>
      </ion-accordion-group>

      <div style="display: flex; gap: 0.5em; margin-top: 1em;">
        <ion-button expand="block" (click)="getRealCoordinates()">Aggiorna coordinate</ion-button>
        <ion-button expand="block" (click)="setFixedPerspectiveView()">Set Fixed Perspective</ion-button>
      </div>

      <ion-item lines="none" style="margin-top:1em;">
        <ion-label>
          <b>Vista Warped (rettificata):</b>
        </ion-label>
      </ion-item>
      <ion-item lines="none">
        <img [src]="dynamicWarpedStreamUrl"
             [width]="imgWidth"
             style="border:1px solid #888; max-width:100%; height:auto; display:block;">
      </ion-item>

    </ion-card-content>
  </ion-card>
</ion-content>
